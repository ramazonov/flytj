<div *ngIf="isVisible" class="modal-background">
  <div class="top-nav__block">
    <span class="close-button" (click)="closeModal()">
      <app-icon icon="arrow-left-icon" color="none"/>
    </span>

    <h3>Бронирование билета</h3>
  </div>

  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="ticket-main__block">
      <div class="d-flex align-center gap-1">
        <span class="cities-title">{{ fromCity }}</span>
        <span class="dash-block"></span>
        <span class="cities-title">{{ toCity }}</span>
        <span class="dash-block" *ngIf="backRouteCity"></span>
        <span class="cities-title" *ngIf="backRouteCity">{{ backRouteCity }}</span>
      </div>

      <span class="to-payment__title mb-2">{{ selectedDateText }} пассажиры: {{ passengerCount }}
        , {{ travelClassText }}</span>
      <span class="to-payment__title">К оплате</span>
      <div class="ticket-main__block-bottom">
        <span class="amount-title">{{ flight.value.total_price.TJS }} TJS</span>
      </div>
    </div>

    <div class="contacts-block">
      <p class="block-title">Контакты покупателя</p>

      <div class="inputs-blocks">
        <div class="card-block">
          <div class="card">
            <input
              [(ngModel)]="walletPhone"
              placeholder="Номер телефона"
              class="text-field"
              inputmode="numeric"
              [class.error]="isValidationTriggered && !isValidPhone(walletPhone)"
              type="text"
              minlength="9"
              maxlength="9"
            >
          </div>
          <div class="invalid-field" *ngIf="isValidationTriggered && !isValidPhone(walletPhone)">
            Введите корректный номер телефона (9 цифр)*
          </div>
        </div>

        <div class="card-block">
          <div class="card">
            <input
              [(ngModel)]="email"
              placeholder="Email"
              class="text-field"
              [class.error]="isValidationTriggered && !isValidEmail(email)"
              type="email"
            >
          </div>
          <div class="invalid-field" *ngIf="isValidationTriggered && !isValidEmail(email)">
            Введите корректный email*
          </div>
        </div>
      </div>

      <p class="desc-bottom__text">
        Отправим Вам купленный билет и чек на электронную
        почту. В случае экстренных ситуаций свяжемся по телефону.
      </p>
    </div>

    <div class="passengers-layout">
      <p class="block-title">Пассажиры</p>
      <div *ngFor="let passenger of passengersDataList; let i = index">
        <div
          class="passenger-block card d-flex align-center justify-between"
          (click)="selectPassenger(passenger, i)"
        >
          <div class="d-flex align-center passenger-block__left">
            <app-icon icon="passenger-avatar" color="none" height="32" width="32"/>

            <div class="d-flex flex-column">
              <div class="d-flex align-center gap-2">
                <p class="ma-0" *ngIf="!formatName(updatedPassengerData)">{{ passenger.count }}</p>
                <small *ngIf="!formatName(updatedPassengerData)">({{ passenger.type }})</small>
                <span *ngIf="formatName(updatedPassengerData)">{{ formatName(updatedPassengerData) }}</span>
              </div>

              <span class="validation-passenger__title" *ngIf="!passenger.isValidPassenger">Заполните данные</span>
              <span
                class="passenger__title"
                *ngIf="passenger.isValidPassenger"
              >
                Пол: {{ transformGender(updatedPassengerData) }} - {{ updatedPassengerData.birthDate }}
              </span>
            </div>
          </div>

          <div class="d-flex align-center passenger-block__right">
            <app-icon icon="arrow-right" color="none"/>
          </div>
        </div>
      </div>
    </div>

    <div class="loader-overlay" *ngIf="isLoading">
      <div class="loader"></div>
    </div>

    <div
      class="validation-popup__layout"
      *ngIf="validationPopup && !isPassengerValidForm()"
    >
      <div class="validation-popup__content">
        <span>Заполните данные для все пассажиров</span>
        <button class="close-popup__button" (click)="closeValidationPopup()">OK</button>
      </div>
    </div>

    <div class="byu-ticket__button" *ngIf="isDetailModalOpen">
      <button class="btn-primary" (click)="createOrderRequest()">
        Купить билет {{ flight.value.total_price.TJS }} TJS
      </button>
    </div>
  </div>
</div>
